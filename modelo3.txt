%% limpeza
clear
close all
clc

%% Importando dados
importar_dados
[aaa, bbb] = find(dados.PM10 == 0);
dados(aaa,:) =[];

numRows = height(dados); %defina o número de linhas na tabela
shuffledIndices = randperm(numRows); % Embaralhe as linhas da tabela
cutoffIndex = round(0.7 * numRows); % Calcule o índice de corte para a divisão 70%

% Divida a tabela
trainData = dados(shuffledIndices(1:cutoffIndex), :);
testData = dados(shuffledIndices(cutoffIndex+1:end), :);

trainInput = ([trainData.Temperatura trainData.UmidadeRelativa trainData.PressoAtmosfricakPa trainData.VelocidadeDoVentoms trainData.DireoDoVentograus]);
%entradas2 = entradas(1:10000,:);
trainOutput = (trainData.PM10);
%saida2 = saida(1:10000,:);

testInput = ([testData.Temperatura testData.UmidadeRelativa testData.PressoAtmosfricakPa testData.VelocidadeDoVentoms testData.DireoDoVentograus]);
testOutput = (testData.PM10);

%% RPG

rpg = fitrgp(trainInput,trainOutput);

yHat = predict(rpg,testInput);

figure
plot(testOutput,'.')
hold on
plot(yHat,'.')
legend("sensor real","sensor virtual")


dif1 = (testOutput - yHat).^2;
soma1 = sum(dif1);
dif2 = (testOutput).^2;
soma2 = sum(dif2);
MRSE = (sqrt(soma1/soma2))*100;